<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cinematic Canvas – Auth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      display:flex; align-items:center; justify-content:center;
      height:100vh; background:#000; color:#fff;
      font-family:'Segoe UI', sans-serif;
    }
    .auth-container {
      width:90%; max-width:400px; padding:2rem;
      background:rgba(255,255,255,0.05); backdrop-filter:blur(20px);
      border:1px solid rgba(255,255,255,0.1); border-radius:16px;
      box-shadow:0 8px 32px rgba(0,0,0,0.8);
      display:flex; flex-direction:column; align-items:center; gap:1rem;
    }
    .cl-signInBox, .cl-userButtonBox {
      width:100% !important;
      background:rgba(255,255,255,0.08) !important;
      backdrop-filter:blur(12px) !important;
      border:1px solid rgba(255,255,255,0.12) !important;
      border-radius:12px !important;
    }
    .cl-signInBox > div, .cl-userButtonBox > div {
      padding:1rem !important;
    }
    #sign-out {
      margin-top:1rem; padding:0.75rem 1.5rem;
      background:rgba(255,255,255,0.1); border:none; border-radius:8px;
      cursor:pointer; transition:background .2s; color:#fff;
    }
    #sign-out:hover { background:rgba(255,255,255,0.2); }
  </style>
  <script
    async
    crossorigin="anonymous"
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
    data-clerk-publishable-key="pk_test_ZHJpdmVuLXRlYWwtNjMuY2xlcmsuYWNjb3VudHMuZGV2JA">
  </script>
</head>
<body>
  <div id="app" class="auth-container">Loading…</div>

  <script>
    (async () => {
      if (typeof Clerk === 'undefined') {
        document.getElementById('app').textContent = 'Error loading Clerk.';
        return;
      }
      await Clerk.load();

      const url = new URL(window.location.href);
      // handle both handshake and status callbacks
      if (url.searchParams.has('__clerk_handshake') || url.searchParams.has('__clerk_status')) {
        try {
          await Clerk.handleRedirectCallback();
        } catch (e) {
          console.error('Callback error', e);
        }
        // clean URL
        url.searchParams.delete('__clerk_handshake');
        url.searchParams.delete('__clerk_status');
        window.history.replaceState({}, '', url.pathname);
      }

      const app = document.getElementById('app');
      if (Clerk.user) {
        // already signed in → go to wall.html
        app.innerHTML = `<p>Signed in! Redirecting…</p>`;
        setTimeout(() => {
          window.location.href = 'https://hunainsualeh.github.io/The-Cinematic-Canvas/wall.html';
        }, 200);
      } else {
        // show sign-in form
        app.innerHTML = `<div id="sign-in"></div>`;
        Clerk.mountSignIn(document.getElementById('sign-in'), {
          redirectUrl: 'https://hunainsualeh.github.io/The-Cinematic-Canvas/auth.html',
          afterSignInUrl: 'https://hunainsualeh.github.io/The-Cinematic-Canvas/wall.html',
          afterSignUpUrl: 'https://hunainsualeh.github.io/The-Cinematic-Canvas/wall.html'
        });
      }
    })();
  </script>
</body>
</html>
