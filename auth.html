<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cinematic Canvas – Auth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      display:flex; align-items:center; justify-content:center;
      min-height:100vh; background:#000; color:#fff;
      font-family:'Segoe UI', sans-serif;
    }
    .auth-container {
      width:90%; max-width:400px; padding:2rem;
      background:rgba(255,255,255,0.05); backdrop-filter:blur(20px);
      border:1px solid rgba(255,255,255,0.1); border-radius:16px;
      box-shadow:0 8px 32px rgba(0,0,0,0.8);
      display:flex; flex-direction:column; align-items:center; gap:1rem;
    }
    /* Clerk widget overrides */
    .cl-signIn, .cl-userButton {
      width:100% !important;
    }
  </style>

  <!-- ClerkJS SDK -->
  <script
    async
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
    data-clerk-publishable-key="pk_test_ZHJpdmVuLXRlYWwtNjMuY2xlcmsuYWNjb3VudHMuZGV2JA"
  ></script>
</head>
<body>
  <div id="auth" class="auth-container">
    <p>Loading…</p>
  </div>

  <script>
    (async () => {
      const container = document.getElementById('auth');

      // Wait for Clerk to be available
      if (typeof Clerk === 'undefined') {
        container.innerHTML = '<p style="color:#f55">Error loading authentication library.</p>';
        return;
      }
      await Clerk.load();

      // Handle OAuth callback params and clean URL
      const url = new URL(window.location);
      if (url.searchParams.has('__clerk_handshake') || url.searchParams.has('__clerk_status')) {
        try {
          await Clerk.handleRedirectCallback();
        } catch (err) {
          console.error('Clerk callback failed', err);
        }
        url.searchParams.delete('__clerk_handshake');
        url.searchParams.delete('__clerk_status');
        history.replaceState({}, '', url.pathname);
      }

      // If already signed in, redirect at once
      if (Clerk.user) {
        container.innerHTML = '<p>Signed in! Redirecting…</p>';
        return void (window.location.href = './Wall.html');
      }

      // Otherwise, mount the sign-in form
      container.innerHTML = '<div id="sign-in"></div>';
      Clerk.mountSignIn(document.getElementById('sign-in'), {
        redirectUrl: window.location.origin + window.location.pathname,
        afterSignInUrl: './Wall.html',
        afterSignUpUrl: './Wall.html'
      });
    })();
  </script>
</body>
</html>
